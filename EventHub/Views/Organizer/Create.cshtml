@model EventHub.Models.Entities.Event
@{
    ViewData["Title"] = "Create New Event - EventHub";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/organizer-create-event.css" asp-append-version="true" />
}

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="header-content">
            <div class="header-text">
                <h1 class="page-title"><i class="bi bi-plus-circle me-3"></i>Create New Event</h1>
                <p class="page-subtitle">Fill in the details below to create your event</p>
            </div>
        </div>
    </div>
</section>

<!-- Create Event Form -->
<section class="create-event-section py-5">
    <div class="container">
        <!-- CRITICAL: Form tag without novalidate or needs-validation -->
        <form asp-action="Create" asp-controller="Organizer" method="post"
              enctype="multipart/form-data" id="createEventForm">
            @Html.AntiForgeryToken()

            <div class="row g-4">
                <!-- Left Column - Form Fields -->
                <div class="col-lg-8">
                    <!-- Basic Information -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5 class="section-title">
                                <i class="bi bi-info-circle me-2"></i>Basic Information
                            </h5>
                        </div>
                        <div class="section-content">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label asp-for="Title" class="form-label">Event Title *</label>
                                    <input asp-for="Title" class="form-control"
                                           placeholder="Enter event title" maxlength="200" />
                                    <span asp-validation-for="Title" class="text-danger"></span>
                                    <small class="text-muted">
                                        <span id="titleCount">0</span>/200 characters
                                    </small>
                                </div>

                                <div class="col-md-6">
                                    <label asp-for="Category" class="form-label">Category *</label>
                                    <select asp-for="Category" class="form-select">
                                        <option value="">Select category</option>
                                        <option value="Music">Music</option>
                                        <option value="Sports">Sports</option>
                                        <option value="Theatre">Theatre</option>
                                        <option value="Conference">Conference</option>
                                        <option value="Workshop">Workshop</option>
                                        <option value="Festival">Festival</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <span asp-validation-for="Category" class="text-danger"></span>
                                </div>

                                <div class="col-md-6">
                                    <label asp-for="IsActive" class="form-label">Status *</label>
                                    <select asp-for="IsActive" class="form-select">
                                        <option value="true">Active (Publish immediately)</option>
                                        <option value="false">Draft (Save without publishing)</option>
                                    </select>
                                </div>

                                <div class="col-12">
                                    <label asp-for="Description" class="form-label">Event Description *</label>
                                    <textarea asp-for="Description" class="form-control" rows="5"
                                              placeholder="Describe your event" maxlength="1000"></textarea>
                                    <span asp-validation-for="Description" class="text-danger"></span>
                                    <small class="text-muted">
                                        <span id="descriptionCount">0</span>/1000 characters
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Date & Time -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5 class="section-title">
                                <i class="bi bi-calendar-event me-2"></i>Date & Time
                            </h5>
                        </div>
                        <div class="section-content">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label asp-for="EventDate" class="form-label">Event Date *</label>
                                    <input asp-for="EventDate" type="date" class="form-control" />
                                    <span asp-validation-for="EventDate" class="text-danger"></span>
                                </div>

                                <div class="col-md-6">
                                    <label asp-for="EventTime" class="form-label">Event Time *</label>
                                    <input asp-for="EventTime" type="time" class="form-control" />
                                    <span asp-validation-for="EventTime" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Venue Section -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5 class="section-title">
                                <i class="bi bi-geo-alt me-2"></i>Venue Information
                            </h5>
                        </div>
                        <div class="section-content">
                            <div class="row g-3">
                                <!-- Venue Selection Type -->
                                <div class="col-12">
                                    <div class="btn-group w-100" role="group">
                                        <input type="radio" class="btn-check" name="venueType" id="existingVenue"
                                               value="existing" checked autocomplete="off">
                                        <label class="btn btn-outline-primary" for="existingVenue">
                                            <i class="bi bi-building me-2"></i>Select Existing Venue
                                        </label>

                                        <input type="radio" class="btn-check" name="venueType" id="newVenue"
                                               value="new" autocomplete="off">
                                        <label class="btn btn-outline-primary" for="newVenue">
                                            <i class="bi bi-plus-circle me-2"></i>Create New Venue
                                        </label>
                                    </div>
                                </div>

                                <!-- Existing Venue Dropdown -->
                                <div class="col-12" id="existingVenueSection">
                                    <label asp-for="VenueId" class="form-label">Select Venue *</label>
                                    <select asp-for="VenueId" class="form-select" id="venueDropdown">
                                        <option value="">-- Select a venue --</option>
                                        @if (ViewBag.Venues != null)
                                        {
                                            foreach (var venue in ViewBag.Venues)
                                            {
                                                <option value="@venue.Id">
                                                    @venue.Name - @venue.Location (Capacity: @venue.Capacity)
                                                </option>
                                            }
                                        }
                                    </select>
                                    <span asp-validation-for="VenueId" class="text-danger"></span>
                                </div>

                                <!-- New Venue Fields (Hidden by default) -->
                                <div id="newVenueSection" style="display: none;">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="newVenueName" class="form-label">Venue Name *</label>
                                            <input type="text" class="form-control" id="newVenueName"
                                                   name="NewVenueName" placeholder="Enter venue name">
                                            <span class="text-danger" id="newVenueNameError"></span>
                                        </div>

                                        <div class="col-md-6">
                                            <label for="newVenueLocation" class="form-label">Location/City *</label>
                                            <input type="text" class="form-control" id="newVenueLocation"
                                                   name="NewVenueLocation" placeholder="Enter location">
                                            <span class="text-danger" id="newVenueLocationError"></span>
                                        </div>

                                        <div class="col-md-6">
                                            <label for="newVenueCapacity" class="form-label">Capacity *</label>
                                            <input type="number" class="form-control" id="newVenueCapacity"
                                                   name="NewVenueCapacity" placeholder="100" min="1">
                                            <span class="text-danger" id="newVenueCapacityError"></span>
                                        </div>

                                        <div class="col-md-6">
                                            <label for="newVenueAddress" class="form-label">Full Address</label>
                                            <input type="text" class="form-control" id="newVenueAddress"
                                                   name="NewVenueAddress" placeholder="Street address (optional)">
                                        </div>

                                        <div class="col-12">
                                            <div class="alert alert-info">
                                                <i class="bi bi-info-circle me-2"></i>
                                                A new venue will be created and saved for future use.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pricing & Tickets -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5 class="section-title">
                                <i class="bi bi-ticket-perforated me-2"></i>Pricing & Tickets
                            </h5>
                        </div>
                        <div class="section-content">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label asp-for="TicketPrice" class="form-label">Ticket Price (Rs.) *</label>
                                    <input asp-for="TicketPrice" type="number" step="0.01" min="0"
                                           class="form-control" placeholder="0.00" />
                                    <span asp-validation-for="TicketPrice" class="text-danger"></span>
                                </div>

                                <div class="col-md-6">
                                    <label asp-for="AvailableTickets" class="form-label">Available Tickets *</label>
                                    <input asp-for="AvailableTickets" type="number" min="1"
                                           class="form-control" placeholder="100" />
                                    <span asp-validation-for="AvailableTickets" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Image Upload -->
                    <div class="form-section">
                        <div class="section-header">
                            <h5 class="section-title">
                                <i class="bi bi-image me-2"></i>Event Image
                            </h5>
                        </div>
                        <div class="section-content">
                            <div class="image-upload-area" id="imageUploadArea">
                                <input type="file" id="eventImage" name="eventImage"
                                       accept="image/*" style="display: none;" />
                                <div class="upload-placeholder">
                                    <i class="bi bi-cloud-upload"></i>
                                    <h6>Click to upload or drag and drop</h6>
                                    <p>PNG, JPG up to 10MB</p>
                                </div>
                                <div class="image-preview d-none" id="imagePreview">
                                    <img id="previewImage" src="" alt="Preview" />
                                    <button type="button" class="btn btn-sm btn-danger remove-image">
                                        <i class="bi bi-x"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline-secondary"
                                onclick="window.location.href='@Url.Action("Dashboard", "Organizer")'">
                            <i class="bi bi-x-circle me-2"></i>Cancel
                        </button>
                        <button type="submit" name="IsActive" value="false" class="btn btn-outline-primary">
                            <i class="bi bi-save me-2"></i>Save as Draft
                        </button>
                        <button type="submit" name="IsActive" value="true" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Publish Event
                        </button>
                    </div>
                </div>

                <!-- Right Column - Preview (Optional, can be removed for testing) -->
                <div class="col-lg-4">
                    <div class="preview-card sticky-top">
                        <div class="preview-header">
                            <h6 class="preview-title">
                                <i class="bi bi-eye me-2"></i>Event Preview
                            </h6>
                        </div>
                        <div class="preview-content">
                            <div class="preview-image">
                                <img id="previewCardImage" src="/images/events/default-event.jpg" alt="Preview" />
                                <div class="preview-badge">
                                    <span id="previewCategory">Category</span>
                                </div>
                            </div>
                            <div class="preview-details">
                                <h5 id="previewTitle">Event Title</h5>
                                <div class="preview-info">
                                    <div class="info-item">
                                        <i class="bi bi-calendar"></i>
                                        <span id="previewDate">Select date</span>
                                    </div>
                                    <div class="info-item">
                                        <i class="bi bi-clock"></i>
                                        <span id="previewTime">Select time</span>
                                    </div>
                                    <div class="info-item">
                                        <i class="bi bi-geo-alt"></i>
                                        <span id="previewVenue">Select venue</span>
                                    </div>
                                    <div class="info-item">
                                        <i class="bi bi-ticket"></i>
                                        <span id="previewTickets">0 tickets</span>
                                    </div>
                                </div>
                                <div class="preview-price">
                                    <span class="price-label">Starting from</span>
                                    <span class="price-value">Rs. <span id="previewPrice">0.00</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</section>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="~/js/organizer-create-event.js" asp-append-version="true"></script>


}